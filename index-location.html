<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Test All | Location</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <style type="text/css">
        html{height:100%}
        body{height:100%;margin:0px;padding:0px}
        #container{height:100%}
    </style>
    <script src="../lib/location.js"></script>
    <script id="baiduMapKey" type="text/javascript" src="...."></script>
  </head>
  <body>
    <div id="container"></div>
    <script type="text/javascript">
      var map = new BMap.Map("container");
      var point = new BMap.Point(116.404, 39.915);

      map.centerAndZoom(point, 16);
      //开启鼠标滚轮缩放
      map.enableScrollWheelZoom(true);

      if (navigator.geolocation) {
        var geolocation = new BMap.Geolocation();
        geolocation.getCurrentPosition(function(r) {
          if (this.getStatus() == BMAP_STATUS_SUCCESS) {
            if (r.point.lng == 0 && r.point.lat == 0) {
              new BMap.LocalCity().get(function(result) {
                map.setCenter(result.name);
                alert("当前定位城市: " + result.name);
              });
            } else {
              var mk = new BMap.Marker(r.point);
              map.addOverlay(mk);
              map.panTo(r.point);
              alert("当前定位位置： " + r.point.lng + ", " + r.point.lat);
            }
          } else {
            alert("failed: " + this.getStatus());
          }
        }, {enableHighAccuracy: true});
      } else {
        new BMap.LocalCity().get(function(result) {
          map.setCenter(result.name);
          alert("当前定位城市: " + result.name);
        });
      }
    </script>
  </body>
</html>
